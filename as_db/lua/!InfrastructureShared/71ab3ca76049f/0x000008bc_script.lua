-- Decompiled using luadec 2.2 rev: 895d923 for Lua 5.1 from https://github.com/viruscamp/luadec
-- Command line: db 092023\as_db\lua\!InfrastructureShared\71ab3ca76049f\0x000008bc_luac 

-- params : ...
-- function num : 0
local l_0_0 = IsProcNameInParentProcessTree
local l_0_1 = "BM"
local l_0_2 = {}
-- DECOMPILER ERROR at PC6: No list found for R2 , SetList fails

-- DECOMPILER ERROR at PC10: Overwrote pending register: R0 in 'AssignReg'

-- DECOMPILER ERROR at PC11: Overwrote pending register: R0 in 'AssignReg'

if l_0_0 then
  return l_0_0
end
-- DECOMPILER ERROR at PC13: Overwrote pending register: R0 in 'AssignReg'

-- DECOMPILER ERROR at PC15: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC16: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC19: Overwrote pending register: R0 in 'AssignReg'

-- DECOMPILER ERROR at PC20: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC21: Overwrote pending register: R1 in 'AssignReg'

-- DECOMPILER ERROR at PC23: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC24: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC25: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC28: Overwrote pending register: R0 in 'AssignReg'

-- DECOMPILER ERROR at PC29: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC30: Overwrote pending register: R1 in 'AssignReg'

-- DECOMPILER ERROR at PC32: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC33: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC34: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC37: Overwrote pending register: R0 in 'AssignReg'

-- DECOMPILER ERROR at PC38: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC39: Overwrote pending register: R1 in 'AssignReg'

-- DECOMPILER ERROR at PC41: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC42: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC43: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC46: Overwrote pending register: R0 in 'AssignReg'

-- DECOMPILER ERROR at PC47: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC48: Overwrote pending register: R1 in 'AssignReg'

-- DECOMPILER ERROR at PC50: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC51: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC52: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC55: Overwrote pending register: R0 in 'AssignReg'

-- DECOMPILER ERROR at PC56: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC57: Overwrote pending register: R1 in 'AssignReg'

-- DECOMPILER ERROR at PC59: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC60: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC61: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC64: Overwrote pending register: R0 in 'AssignReg'

-- DECOMPILER ERROR at PC65: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC66: Overwrote pending register: R1 in 'AssignReg'

-- DECOMPILER ERROR at PC68: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC69: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC70: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC73: Overwrote pending register: R0 in 'AssignReg'

-- DECOMPILER ERROR at PC74: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC75: Overwrote pending register: R1 in 'AssignReg'

-- DECOMPILER ERROR at PC77: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC78: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC79: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC82: Overwrote pending register: R0 in 'AssignReg'

-- DECOMPILER ERROR at PC83: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC84: Overwrote pending register: R1 in 'AssignReg'

-- DECOMPILER ERROR at PC86: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC87: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC88: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC91: Overwrote pending register: R0 in 'AssignReg'

-- DECOMPILER ERROR at PC92: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC93: Overwrote pending register: R1 in 'AssignReg'

-- DECOMPILER ERROR at PC95: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC96: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC97: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC100: Overwrote pending register: R0 in 'AssignReg'

-- DECOMPILER ERROR at PC101: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC102: Overwrote pending register: R1 in 'AssignReg'

-- DECOMPILER ERROR at PC104: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC105: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC106: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC109: Overwrote pending register: R0 in 'AssignReg'

-- DECOMPILER ERROR at PC110: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC111: Overwrote pending register: R1 in 'AssignReg'

-- DECOMPILER ERROR at PC113: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC114: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC115: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC118: Overwrote pending register: R0 in 'AssignReg'

-- DECOMPILER ERROR at PC119: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC120: Overwrote pending register: R1 in 'AssignReg'

-- DECOMPILER ERROR at PC122: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC123: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC124: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC127: Overwrote pending register: R0 in 'AssignReg'

-- DECOMPILER ERROR at PC128: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC129: Overwrote pending register: R1 in 'AssignReg'

-- DECOMPILER ERROR at PC131: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC132: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC133: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC136: Overwrote pending register: R0 in 'AssignReg'

-- DECOMPILER ERROR at PC137: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC138: Overwrote pending register: R1 in 'AssignReg'

-- DECOMPILER ERROR at PC140: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC141: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC142: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC145: Overwrote pending register: R0 in 'AssignReg'

-- DECOMPILER ERROR at PC146: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC147: Overwrote pending register: R1 in 'AssignReg'

-- DECOMPILER ERROR at PC149: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC150: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC151: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC154: Overwrote pending register: R0 in 'AssignReg'

-- DECOMPILER ERROR at PC155: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC156: Overwrote pending register: R1 in 'AssignReg'

-- DECOMPILER ERROR at PC158: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC159: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC160: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC163: Overwrote pending register: R0 in 'AssignReg'

-- DECOMPILER ERROR at PC164: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC165: Overwrote pending register: R1 in 'AssignReg'

-- DECOMPILER ERROR at PC167: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC168: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC169: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC172: Overwrote pending register: R0 in 'AssignReg'

-- DECOMPILER ERROR at PC173: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC174: Overwrote pending register: R1 in 'AssignReg'

-- DECOMPILER ERROR at PC176: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC177: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC178: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC181: Overwrote pending register: R0 in 'AssignReg'

-- DECOMPILER ERROR at PC182: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC183: Overwrote pending register: R1 in 'AssignReg'

-- DECOMPILER ERROR at PC185: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC186: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC187: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC190: Overwrote pending register: R0 in 'AssignReg'

-- DECOMPILER ERROR at PC191: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC192: Overwrote pending register: R1 in 'AssignReg'

-- DECOMPILER ERROR at PC194: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC195: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC196: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC199: Overwrote pending register: R0 in 'AssignReg'

-- DECOMPILER ERROR at PC200: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC201: Overwrote pending register: R1 in 'AssignReg'

-- DECOMPILER ERROR at PC203: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC204: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC205: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC208: Overwrote pending register: R0 in 'AssignReg'

-- DECOMPILER ERROR at PC209: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC210: Overwrote pending register: R1 in 'AssignReg'

-- DECOMPILER ERROR at PC212: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC213: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC214: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC217: Overwrote pending register: R0 in 'AssignReg'

-- DECOMPILER ERROR at PC218: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC219: Overwrote pending register: R1 in 'AssignReg'

-- DECOMPILER ERROR at PC221: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC222: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC223: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC226: Overwrote pending register: R0 in 'AssignReg'

-- DECOMPILER ERROR at PC227: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC228: Overwrote pending register: R1 in 'AssignReg'

-- DECOMPILER ERROR at PC230: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC231: Overwrote pending register: R2 in 'AssignReg'

if ((((((((((((((((((((((not l_0_2 or l_0_2) and not l_0_2) or l_0_2) and not l_0_2) or l_0_2) and not l_0_2) or l_0_2) and not l_0_2) or l_0_2) and not l_0_2) or l_0_2) and not l_0_2) or l_0_2) and not l_0_2) or l_0_2) and not l_0_2) or l_0_2) and not l_0_2) or l_0_2) and not l_0_2) or l_0_2) and not l_0_2) or l_0_2 then
  do return l_0_2 end
  local l_0_3 = {}
  -- DECOMPILER ERROR at PC235: Overwrote pending register: R4 in 'AssignReg'

  -- DECOMPILER ERROR at PC236: Overwrote pending register: R5 in 'AssignReg'

  -- DECOMPILER ERROR at PC237: No list found for R3 , SetList fails

  -- DECOMPILER ERROR at PC240: Overwrote pending register: R4 in 'AssignReg'

  -- DECOMPILER ERROR at PC253: Overwrote pending register: R5 in 'AssignReg'

  l_0_3 = {"taniumclient.exe", "agentexecutor.exe"}
  l_0_3 = {}
  l_0_3 = {"emsystem.exe"}
  l_0_3 = {}
  l_0_3 = {}
  l_0_3 = {"dagent.exe"}
  l_0_3 = {}
  l_0_3 = {"sqlps.exe", "java.exe"}
  l_0_3 = {"oneagentplugin.exe"}
  l_0_3 = {}
  l_0_3 = {}
  l_0_3 = {}
  l_0_3 = {}
  l_0_3 = {"dartcli.exe", "java.exe"}
  l_0_3 = {}
  l_0_3 = {}
  l_0_3 = {}
  l_0_3 = {}
  l_0_3 = {"eclipse.exe", "javaw.exe", "java.exe"}
  l_0_3 = IsProcNameInParentProcessTree
  l_0_3 = l_0_3("BM", l_0_2[l_0_0])
  if l_0_3 then
    l_0_3 = mp
    l_0_3 = l_0_3.CLEAN
    return l_0_3
  end
  do
    local l_0_4, l_0_5 = l_0_3[l_0_0] or 0
    local l_0_6 = nil
    local l_0_7 = {[20] = "L", [40] = "M", [60] = "H", [80] = "H+"}
    local l_0_8 = {[15] = "L", [30] = "M", [45] = "H", [60] = "H+"}
    local l_0_9 = "ReconTracking"
    local l_0_10 = 14400
    local l_0_11 = 100
    local l_0_12 = "|"
    local l_0_13 = (bm.get_current_process_startup_info)()
    local l_0_14 = reportSessionInformation()
    AppendToRollingQueue(l_0_9, l_0_13.ppid .. l_0_12 .. l_0_1.ppid .. l_0_12 .. l_0_1.utf8p1 .. l_0_12 .. l_0_0 .. l_0_12 .. l_0_1.utf8p2, l_0_6, l_0_10, l_0_11)
    if l_0_14.User == nil or (l_0_14.User).UserName == nil or l_0_14.Session == nil or (l_0_14.Session).Id == nil then
      return mp.CLEAN
    end
    local l_0_15 = nil
    AppendToRollingQueue(l_0_9 .. "-" .. (l_0_14.User).UserName .. "[::]" .. tostring((l_0_14.Session).Id), l_0_15, l_0_6, l_0_10, l_0_11)
    -- DECOMPILER ERROR at PC417: Confused about usage of register: R14 in 'UnsetPending'

    local l_0_16 = nil
    local l_0_17, l_0_18 = , CheckNewThresholdMet((GetRollingQueueSumOfValues(l_0_9 .. "-" .. (l_0_14.User).UserName .. "[::]" .. tostring((l_0_14.Session).Id))).sum, l_0_6, l_0_8)
    -- DECOMPILER ERROR at PC429: Overwrote pending register: R1 in 'AssignReg'

    if l_0_18 then
      local l_0_19 = nil
      local l_0_20 = bm.add_related_string
      local l_0_21 = "MassRecon_" .. l_0_19 .. "_User"
      local l_0_22 = safeJsonSerialize
      l_0_22 = l_0_22({score = l_0_17, events = l_0_1})
      l_0_20(l_0_21, l_0_22, bm.RelatedStringBMReport)
      if l_0_19 == "H+" then
        l_0_20 = reportMassReconHistory
        l_0_21 = l_0_16
        l_0_22 = l_0_19
        l_0_20(l_0_21, l_0_22, "_User")
        l_0_20 = mp
        l_0_20 = l_0_20.INFECTED
        return l_0_20
      end
    end
    do
      l_0_17 = GetRollingQueueSumOfValues(l_0_9)
      -- DECOMPILER ERROR at PC470: Overwrote pending register: R1 in 'AssignReg'

      if l_0_18 then
        local l_0_23 = R17_PC473
        local l_0_24 = bm.trigger_sig
        local l_0_25 = "MassRecon_" .. l_0_23 .. "_Machine"
        local l_0_26 = safeJsonSerialize
        l_0_24(l_0_25, l_0_26({score = l_0_17, events = l_0_1}))
        if l_0_23 == "H+" then
          l_0_24 = reportMassReconHistory
          l_0_25 = l_0_9
          l_0_24(l_0_25, l_0_23, "_Machine")
          l_0_24 = mp
          l_0_24 = l_0_24.INFECTED
          do return l_0_24 end
          -- DECOMPILER ERROR at PC493: Confused about usage of register R20 for local variables in 'ReleaseLocals'

        end
      end
      l_0_24 = mp
      l_0_24 = l_0_24.CLEAN
      return l_0_24
    end
  end
end

